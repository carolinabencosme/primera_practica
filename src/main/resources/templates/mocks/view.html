<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" xmlns:sec="http://www.thymeleaf.org/extras/spring-security"
      th:replace="~{layout/base :: layout(~{::title}, ~{::th:block[@data-role='styles']}, ~{::div[@data-role='content']}, ~{::th:block[@data-role='scripts']})}">
<head>
    <title th:text="${mock.name} + ' - Mockup API Server'">Mock Details</title>
    <th:block data-role="styles">
        <style>
            .mock-view-header {
                background: var(--surface);
                border: 1px solid var(--border);
                border-radius: var(--r-lg);
                padding: var(--space-6);
                margin-bottom: var(--space-6);
            }

            .method-path-row {
                display: flex;
                align-items: center;
                gap: var(--space-4);
                flex-wrap: wrap;
                margin-bottom: var(--space-4);
            }

            .mock-path {
                font-family: var(--font-mono);
                font-size: var(--text-lg);
                color: var(--text);
                padding: var(--space-2) var(--space-4);
                background: var(--surface-2);
                border-radius: var(--r-md);
                flex: 1;
                min-width: 200px;
            }

            .copy-btn {
                padding: var(--space-2) var(--space-4);
                background: var(--surface);
                border: 1px solid var(--border);
                border-radius: var(--r-md);
                color: var(--text);
                cursor: pointer;
                transition: all 0.2s;
                font-size: var(--text-sm);
                font-weight: var(--weight-medium);
            }

            .copy-btn:hover {
                background: var(--primary);
                color: white;
                border-color: var(--primary);
            }

            .response-preview {
                background: var(--code-bg);
                color: var(--code-text);
                padding: var(--space-4);
                border-radius: var(--r-md);
                font-family: var(--font-mono);
                font-size: var(--text-sm);
                overflow-x: auto;
                max-height: 400px;
                line-height: var(--leading-relaxed);
            }

            .detail-card {
                background: var(--surface);
                border: 1px solid var(--border);
                border-radius: var(--r-lg);
                padding: var(--space-6);
                margin-bottom: var(--space-6);
            }

            .detail-card h3 {
                font-size: var(--text-xl);
                font-weight: var(--weight-semibold);
                margin-bottom: var(--space-4);
                color: var(--text);
                display: flex;
                align-items: center;
                gap: var(--space-2);
            }

            .detail-row {
                display: grid;
                grid-template-columns: 150px 1fr;
                gap: var(--space-3);
                padding: var(--space-3) 0;
                border-bottom: 1px solid var(--border);
            }

            .detail-row:last-child {
                border-bottom: none;
            }

            .detail-label {
                font-weight: var(--weight-medium);
                color: var(--muted);
                font-size: var(--text-sm);
            }

            .detail-value {
                color: var(--text);
                font-size: var(--text-sm);
            }

            .jwt-block {
                background: var(--surface-2);
                padding: var(--space-4);
                border-radius: var(--r-md);
                margin-bottom: var(--space-4);
                border-left: 3px solid var(--warning);
            }

            .jwt-code {
                background: var(--surface);
                padding: var(--space-3);
                border-radius: var(--r-sm);
                font-family: var(--font-mono);
                font-size: var(--text-xs);
                word-break: break-all;
                color: var(--text);
                margin: var(--space-2) 0;
            }
        </style>
    </th:block>
    <th:block data-role="scripts"></th:block>
</head>
<body>
    <div data-role="content">
        <!-- Page Header -->
        <div class="page-header">
            <div>
                <h2 class="page-header__title">
                    <i class="bi bi-hdd-network"></i>
                    <span th:text="${mock.name}">Mock Name</span>
                </h2>
                <p class="page-header__subtitle">Review configuration and response details for this endpoint</p>
            </div>
            <div class="page-header__actions">
                <a th:href="@{/mocks(projectId=${mock.projectId})}" class="btn-clean btn-ghost">
                    <i class="bi bi-arrow-left"></i> Back
                </a>
                <a th:href="@{/mocks/{id}/edit(id=${mock.id})}" class="btn-clean btn-soft">
                    <i class="bi bi-pencil"></i> Edit
                </a>
                <form th:action="@{/mocks/{id}/delete(id=${mock.id})}" method="post" class="d-inline"
                      onsubmit="return confirm('Are you sure you want to delete this mock endpoint?');">
                    <button type="submit" class="btn-clean btn-danger-clean">
                        <i class="bi bi-trash"></i> Delete
                    </button>
                </form>
            </div>
        </div>

        <!-- Expiration Warning -->
        <div th:if="${mock.expirationDate != null and mock.expirationDate.isBefore(T(java.time.LocalDateTime).now())}" 
             class="alert-clean alert-danger mb-4" role="alert">
            <i class="bi bi-exclamation-triangle-fill"></i>
            <span><strong>This endpoint has expired!</strong> It will not respond to requests.</span>
        </div>

        <!-- Method & Path Display -->
        <div class="mock-view-header">
            <div class="method-path-row">
                <span class="badge" th:classappend="${mock.method.name() == 'GET' ? 'badge-method-get' :
                                                      mock.method.name() == 'POST' ? 'badge-method-post' :
                                                      mock.method.name() == 'PUT' || mock.method.name() == 'PATCH' ? 'badge-method-put' :
                                                      mock.method.name() == 'DELETE' ? 'badge-method-delete' : 'badge--muted'}"
                      style="font-size: var(--text-base); padding: var(--space-2) var(--space-4);"
                      th:text="${mock.method}">Method</span>
                <code class="mock-path" th:text="'/api/mock/' + ${mock.projectName} + ${mock.path}">URL</code>
                <button class="copy-btn" 
                        th:attr="data-copy='/api/mock/' + ${mock.projectName} + ${mock.path}, data-copy-message='API URL copied!'"
                        aria-label="Copy API URL">
                    <i class="bi bi-clipboard"></i> Copy
                </button>
            </div>
            <div class="d-flex gap-2 align-items-center flex-wrap">
                <span th:if="${mock.requiresJwt}" class="badge badge--warning">
                    <i class="bi bi-shield-lock"></i> JWT Required
                </span>
                <span class="badge badge--muted">
                    Status: <span th:text="${mock.httpStatusCode}">200</span>
                </span>
                <span class="badge badge--muted">
                    <span th:text="${mock.contentType}">Content Type</span>
                </span>
                <span th:if="${mock.expirationDate != null and mock.expirationDate.isBefore(T(java.time.LocalDateTime).now())}" 
                      class="badge badge--danger">EXPIRED</span>
            </div>
        </div>

        <!-- JWT Section -->
        <div th:if="${mock.requiresJwt and #strings.isNotEmpty(mock.generatedJwt)}" class="detail-card">
            <h3><i class="bi bi-shield-lock text-warning"></i> JWT Authorization</h3>
            <p class="text-sm text-muted mb-4">Use this token to authorize requests to this endpoint</p>
            
            <div class="jwt-block">
                <div class="mb-3">
                    <label class="detail-label mb-2">JWT Token:</label>
                    <div class="jwt-code" th:text="${mock.generatedJwt}">token</div>
                    <button class="btn-clean btn-soft btn-sm mt-2"
                            th:attr="data-copy=${mock.generatedJwt}, data-copy-message='JWT token copied!'">
                        <i class="bi bi-clipboard"></i> Copy Token
                    </button>
                </div>
                
                <div>
                    <label class="detail-label mb-2">Authorization Header:</label>
                    <div class="jwt-code" th:text="'Authorization: Bearer ' + ${mock.generatedJwt}">Authorization</div>
                    <button class="btn-clean btn-soft btn-sm mt-2"
                            th:attr="data-copy='Authorization: Bearer ' + ${mock.generatedJwt}, data-copy-message='Header copied!'">
                        <i class="bi bi-clipboard"></i> Copy Header
                    </button>
                </div>
            </div>
        </div>

        <div class="row">
            <!-- Basic Information -->
            <div class="col-md-6">
                <div class="detail-card">
                    <h3><i class="bi bi-info-circle text-primary"></i> Basic Information</h3>
                    <div class="detail-row">
                        <div class="detail-label">Name:</div>
                        <div class="detail-value" th:text="${mock.name}">Name</div>
                    </div>
                    <div class="detail-row">
                        <div class="detail-label">Description:</div>
                        <div class="detail-value" th:text="${mock.description ?: 'No description'}">Description</div>
                    </div>
                    <div class="detail-row">
                        <div class="detail-label">Project:</div>
                        <div class="detail-value">
                            <a th:href="@{/projects/{id}(id=${mock.projectId})}" 
                               th:text="${mock.projectName}"
                               style="color: var(--primary); text-decoration: none;">Project</a>
                        </div>
                    </div>
                    <div class="detail-row">
                        <div class="detail-label">Created By:</div>
                        <div class="detail-value" th:text="${mock.createdBy}">User</div>
                    </div>
                    <div class="detail-row">
                        <div class="detail-label">Created:</div>
                        <div class="detail-value" th:text="${#temporals.format(mock.createdAt, 'yyyy-MM-dd HH:mm')}">Date</div>
                    </div>
                </div>
            </div>

            <!-- Request Configuration -->
            <div class="col-md-6">
                <div class="detail-card">
                    <h3><i class="bi bi-gear text-primary"></i> Request Configuration</h3>
                    <div class="detail-row">
                        <div class="detail-label">Path:</div>
                        <div class="detail-value"><code th:text="${mock.path}">Path</code></div>
                    </div>
                    <div class="detail-row">
                        <div class="detail-label">Delay:</div>
                        <div class="detail-value" th:text="${mock.delaySeconds != null && mock.delaySeconds > 0 ? mock.delaySeconds + ' seconds' : 'None'}">Delay</div>
                    </div>
                    <div class="detail-row">
                        <div class="detail-label">Expires:</div>
                        <div class="detail-value">
                            <span th:if="${mock.expirationDate != null}"
                                  th:text="${#temporals.format(mock.expirationDate, 'yyyy-MM-dd HH:mm')}">Date</span>
                            <span th:unless="${mock.expirationDate != null}">Never</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Response Preview -->
        <div class="detail-card">
            <h3><i class="bi bi-reply text-primary"></i> Response Configuration</h3>
            
            <!-- Custom Headers -->
            <div th:if="${mock.headers != null and !mock.headers.empty}" class="mb-4">
                <label class="detail-label mb-2">Custom Headers:</label>
                <table class="table-clean">
                    <thead>
                        <tr>
                            <th>Header Name</th>
                            <th>Header Value</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr th:each="header : ${mock.headers}">
                            <td><code th:text="${header.headerKey}">Header</code></td>
                            <td><code th:text="${header.headerValue}">Value</code></td>
                        </tr>
                    </tbody>
                </table>
            </div>
            
            <!-- Response Body -->
            <div>
                <label class="detail-label mb-2">Response Body:</label>
                <pre class="response-preview" th:text="${mock.responseBody ?: '(No response body)'}">Response</pre>
                <button th:if="${mock.responseBody != null and !#strings.isEmpty(mock.responseBody)}"
                        class="btn-clean btn-soft btn-sm mt-2"
                        th:attr="data-copy=${mock.responseBody}, data-copy-message='Response body copied!'">
                    <i class="bi bi-clipboard"></i> Copy Response
                </button>
            </div>
        </div>
    </div>
</body>
</html>
